{extend name='extra@admin/content' /}
{block name="style"}
<link rel="stylesheet" href="//cdn.datatables.net/plug-ins/28e7751dbec/integration/bootstrap/3/dataTables.bootstrap.css">
{/block}
{block name="button"}

{/block}

{block name="content"}

<main class="main">
  <div class="mt_box">
    <div class="inquiry_box">
      <form class="form-inline animated form-search" action='{:url("$classuri/index")}' onsubmit="return false" method="get">
        <input type="text" class="form-control" id="classification" placeholder="主分类">
        <input type="text" class="form-control" id="describe" placeholder="物料描述">
        <input type="text" class="form-control" id="number" placeholder="料号">
        <input type="text" class="form-control" id="attribute" placeholder="物料采购属性">
        <button type="button" class="btn btn-info">查询</button>
      </form>
    </div>
    <div class="mt_table">
      <div class="pb_15">
        <button type="button" id="synchronization_btn" class="btn btn-info" style="margin-right: 15px;">立即同步ERP</button>
        <button type="button" id="excel_in" class="btn btn-info" style="margin-right: 15px;">导入Excel</button>
        <button type="button" id="excel_out" class="btn btn-info" style="margin-right: 15px;">导出Excel</button>
      </div>
      <div>
        <table id="example" class="display table table-bordered" cellspacing="0" width="100%">
          <thead>
          <tr>
            <th>主分类</th>
            <th>料号</th>
            <th>物料描述</th>
            <th>物料采购属性</th>
            <th>货期让步比例</th>
            <th>价格权重</th>
            <th>技术权重</th>
            <th>商务权重</th>
            <th>查看\打印条形码</th>
            <th>操作</th>
          </tr>
          </thead>
          <tbody>

          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>
<div class="barcode_box">
  <div class="img_box">
    <p><i href="#" class="close_box"></i></p>
    <section>
      <!--startprint1--><img class="img_code" src="/static/admin/img/u1115.png" alt="条形码"><!--endprint1-->
    </section>
    <p><button id="stamp" type="button" class="mpr_25 btn btn-info">打印</button></p>
  </div>
</div>

{/block}

{block name="script"}
<!--<script src="/static/admin/material/matter.js"/>-->
<script>
  /**
   * 把物料管理页面拉到PHP代码处
   * Created by Administrator on 2017/5/11.
   */

  require(["jquery.dataTables","layui"],function(){
    require(["dataTables.bootstrap"],function(){
      $(document).ready(function() {
        initPage();
      } );
    })
  });

  function initPage(){
    var table = $('#example').DataTable({
      //paging: false, 设置是否分页
      "info": false,  //去除左下角的信息
      "lengthChange": false, //是否允许用户改变表格每页显示的记录数
      "ordering": false, //是否允许Datatables开启排序
      "searching": false,  //是否允许Datatables开启本地搜索
      language: {
        "oPaginate": {
          "sFirst": "首页",
          "sPrevious": "上页",
          "sNext": "下页",
          "sLast": "末页"
        }
      },
      "processing": true,
      "serverSide": true,
      "ajax": {
        "url": '{:url("Material/getSupList")}',
        "type": "POST"
      },
      "pageLength": 10,
      "columns": [
        { "data": "main_name" },
        { "data": "code" },
        { "data": "desc" },
        { "data": "pur_attr" },
        { "data": "future_scale" },
        { "data": "price_weight" },
        { "data": "tech_weight" },
        { "data": "business_weight" },
        { "data": "pay_type_status" },
        { "data": "action" }
      ],
    });

    // tr点击选中事件
    $('#example tbody').on( 'click', 'tr', function () {
      $(this).toggleClass('selected');
    });

    // 立即同步ERP 点击事件
    $('#synchronization_btn').click( function () {
      var url = "{:URL('Material/updataU9Info')}";

      layer.confirm("你确定要同步数据吗？",{
        bth: ['确定','取消']
      },function(index,layero){
        layer.close(index);
        layer.load(1,{
          shade: [0.1,"#fff"]
        });
        $.post(url,function(resdata){
          //console.log(resdata);return;
          layer.closeAll();
          var obj = JSON.parse(resdata);
          if(obj.itemInfo.code == 2000 || obj.supItemInfo.code == 2000){
            $.form.reload();
          }else{
            alert("更新失败");
          }
        })
      });
    });


    //导入Excel
    $("#excel_in").click(function(){
      layer.confirm('<a style="color: #333;">导入前请点击下载最新的导入模版</a>', {
        btn: ['确定导入','取消导入']
      }, function(index){
        layer.close(index);
      });
    })


    //导出
    $("#excel_out").click(function(){
      console.log(1);
      layer.confirm('是否进行导出', {
        btn: ['确定导出','取消导出']
      }, function(index){
        layer.close(index);
        window.open("{:url('Material/exportExcel')}");
      });
    })





  }


  //弹出条形码弹框的点击事件
  $("#example .barcode").click(function(e){
    e.stopPropagation();
    e.preventDefault();
    $(".barcode_box").css("display","block");
  })

  // 关闭条形码的弹出框
  $(".close_box").click(function(){
    $(".barcode_box").css("display","none");
  })

  // 编辑的点击事件
  $("#example .edit").click(function(e){
    // e.stopPropagation();
  })

  // 打印的点击事件
  $("#stamp").click(function(){
    window.print();
  })





</script>
{/block}